{"ast":null,"code":"var _jsxFileName = \"/home/owlytics/Desktop/Grow AI/frontend/src/components/VideoPreview.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst VideoPreview = ({\n  camera,\n  isLive,\n  apiBase\n}) => {\n  _s();\n  const [streamUrl, setStreamUrl] = useState(null);\n  const [error, setError] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // ðŸš¨ CRITICAL FIX: eslint-disable for optimized dependencies\n  // We intentionally don't include full 'camera' object to prevent infinite re-renders\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  useEffect(() => {\n    if (camera && isLive) {\n      // For test preview (from CameraForm) - check if backend has preview-stream endpoint\n      if (camera.rtspUrl && !camera.id) {\n        // Try both possible endpoints\n        setStreamUrl(`${apiBase}/camera/preview-stream?rtspUrl=${encodeURIComponent(camera.rtspUrl)}`);\n      }\n      // For regular camera feed\n      else if (camera.id) {\n        // Try multiple possible stream endpoints\n        // Most common: /camera/stream/{id} or /cameras/stream/{id} or /stream/{id}\n        const possibleEndpoints = [`${apiBase}/camera/stream/${camera.id}`, `${apiBase}/cameras/stream/${camera.id}`, `${apiBase}/stream/${camera.id}`];\n        setStreamUrl(possibleEndpoints[0]); // Start with first\n      }\n      setError(null);\n      setIsLoading(true);\n    } else {\n      setStreamUrl(null);\n      setIsLoading(false);\n    }\n  }, [camera === null || camera === void 0 ? void 0 : camera.id, camera === null || camera === void 0 ? void 0 : camera.rtspUrl, isLive, apiBase]);\n\n  // Helper to try next endpoint if current fails\n  const handleStreamError = () => {\n    console.error(\"Stream loading failed for URL:\", streamUrl);\n    setError(\"Unable to load video stream\");\n    setIsLoading(false);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"video-preview\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-title\",\n        children: camera ? camera.name : \"No Camera Selected\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 9\n      }, this), isLive && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"live-badge\",\n        children: \"LIVE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 54,\n        columnNumber: 20\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-placeholder\",\n      children: streamUrl ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"absolute\",\n            color: \"#fff\",\n            zIndex: 1,\n            padding: \"10px\",\n            background: \"rgba(0,0,0,0.5)\",\n            borderRadius: \"4px\"\n          },\n          children: \"Loading stream...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: streamUrl,\n          alt: \"camera-live\",\n          style: {\n            width: \"100%\",\n            height: \"100%\",\n            objectFit: \"cover\",\n            backgroundColor: \"#000\"\n          },\n          onLoad: () => setIsLoading(false),\n          onError: handleStreamError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : camera ? /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: \"#777\",\n          padding: \"20px\",\n          textAlign: \"center\"\n        },\n        children: [error || \"Click 'Test' to check camera connection\", isLive && !streamUrl && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"12px\",\n            marginTop: \"8px\"\n          },\n          children: \"Starting camera feed...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: \"#777\",\n          padding: \"20px\",\n          textAlign: \"center\"\n        },\n        children: \"Select a camera to preview live feed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 7\n    }, this), process.env.NODE_ENV === \"development\" && streamUrl && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: \"10px\",\n        color: \"#666\",\n        background: \"#f5f5f5\",\n        padding: \"4px\",\n        marginTop: \"4px\",\n        borderRadius: \"3px\"\n      },\n      children: [\"Stream URL: \", streamUrl]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 49,\n    columnNumber: 5\n  }, this);\n};\n_s(VideoPreview, \"k/2rOMVR949t2AnFGB0irr+Ef2o=\");\n_c = VideoPreview;\nexport default VideoPreview;\nvar _c;\n$RefreshReg$(_c, \"VideoPreview\");","map":{"version":3,"names":["React","useState","useEffect","jsxDEV","_jsxDEV","Fragment","_Fragment","VideoPreview","camera","isLive","apiBase","_s","streamUrl","setStreamUrl","error","setError","isLoading","setIsLoading","rtspUrl","id","encodeURIComponent","possibleEndpoints","handleStreamError","console","className","children","name","fileName","_jsxFileName","lineNumber","columnNumber","style","position","color","zIndex","padding","background","borderRadius","src","alt","width","height","objectFit","backgroundColor","onLoad","onError","textAlign","fontSize","marginTop","process","env","NODE_ENV","_c","$RefreshReg$"],"sources":["/home/owlytics/Desktop/Grow AI/frontend/src/components/VideoPreview.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\n\r\nconst VideoPreview = ({ camera, isLive, apiBase }) => {\r\n  const [streamUrl, setStreamUrl] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // ðŸš¨ CRITICAL FIX: eslint-disable for optimized dependencies\r\n  // We intentionally don't include full 'camera' object to prevent infinite re-renders\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (camera && isLive) {\r\n      // For test preview (from CameraForm) - check if backend has preview-stream endpoint\r\n      if (camera.rtspUrl && !camera.id) {\r\n        // Try both possible endpoints\r\n        setStreamUrl(\r\n          `${apiBase}/camera/preview-stream?rtspUrl=${encodeURIComponent(\r\n            camera.rtspUrl\r\n          )}`\r\n        );\r\n      }\r\n      // For regular camera feed\r\n      else if (camera.id) {\r\n        // Try multiple possible stream endpoints\r\n        // Most common: /camera/stream/{id} or /cameras/stream/{id} or /stream/{id}\r\n        const possibleEndpoints = [\r\n          `${apiBase}/camera/stream/${camera.id}`,\r\n          `${apiBase}/cameras/stream/${camera.id}`,\r\n          `${apiBase}/stream/${camera.id}`,\r\n        ];\r\n        setStreamUrl(possibleEndpoints[0]); // Start with first\r\n      }\r\n      setError(null);\r\n      setIsLoading(true);\r\n    } else {\r\n      setStreamUrl(null);\r\n      setIsLoading(false);\r\n    }\r\n  }, [camera?.id, camera?.rtspUrl, isLive, apiBase]);\r\n\r\n  // Helper to try next endpoint if current fails\r\n  const handleStreamError = () => {\r\n    console.error(\"Stream loading failed for URL:\", streamUrl);\r\n    setError(\"Unable to load video stream\");\r\n    setIsLoading(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"video-preview\">\r\n      <div className=\"video-header\">\r\n        <div className=\"video-title\">\r\n          {camera ? camera.name : \"No Camera Selected\"}\r\n        </div>\r\n        {isLive && <div className=\"live-badge\">LIVE</div>}\r\n      </div>\r\n\r\n      <div className=\"video-placeholder\">\r\n        {streamUrl ? (\r\n          <>\r\n            {isLoading && (\r\n              <div\r\n                style={{\r\n                  position: \"absolute\",\r\n                  color: \"#fff\",\r\n                  zIndex: 1,\r\n                  padding: \"10px\",\r\n                  background: \"rgba(0,0,0,0.5)\",\r\n                  borderRadius: \"4px\",\r\n                }}\r\n              >\r\n                Loading stream...\r\n              </div>\r\n            )}\r\n            <img\r\n              src={streamUrl}\r\n              alt=\"camera-live\"\r\n              style={{\r\n                width: \"100%\",\r\n                height: \"100%\",\r\n                objectFit: \"cover\",\r\n                backgroundColor: \"#000\",\r\n              }}\r\n              onLoad={() => setIsLoading(false)}\r\n              onError={handleStreamError}\r\n            />\r\n          </>\r\n        ) : camera ? (\r\n          <div style={{ color: \"#777\", padding: \"20px\", textAlign: \"center\" }}>\r\n            {error || \"Click 'Test' to check camera connection\"}\r\n            {isLive && !streamUrl && (\r\n              <div style={{ fontSize: \"12px\", marginTop: \"8px\" }}>\r\n                Starting camera feed...\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div style={{ color: \"#777\", padding: \"20px\", textAlign: \"center\" }}>\r\n            Select a camera to preview live feed\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Debug info - remove in production */}\r\n      {process.env.NODE_ENV === \"development\" && streamUrl && (\r\n        <div\r\n          style={{\r\n            fontSize: \"10px\",\r\n            color: \"#666\",\r\n            background: \"#f5f5f5\",\r\n            padding: \"4px\",\r\n            marginTop: \"4px\",\r\n            borderRadius: \"3px\",\r\n          }}\r\n        >\r\n          Stream URL: {streamUrl}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoPreview;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}