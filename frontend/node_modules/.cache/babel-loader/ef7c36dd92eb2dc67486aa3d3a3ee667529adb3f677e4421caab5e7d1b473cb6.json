{"ast":null,"code":"var _jsxFileName = \"/home/owlytics/Desktop/Grow AI/frontend/src/components/VideoPreview.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\n\n// Use environment variable for API base URL\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_BASE = import.meta.env.VITE_API_BASE || \"http://localhost:8000\";\nconst VideoPreview = ({\n  camera,\n  isLive,\n  apiBase\n}) => {\n  _s();\n  const [streamUrl, setStreamUrl] = useState(null);\n  const [error, setError] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  useEffect(() => {\n    // ðŸ”´ CRITICAL FIX: Use specific dependencies to prevent unnecessary re-renders\n    if (camera && isLive) {\n      // For test preview (from CameraForm)\n      if (camera.rtspUrl && !camera.id) {\n        setStreamUrl(`${API_BASE}/preview-stream?rtspUrl=${encodeURIComponent(camera.rtspUrl)}`);\n      }\n      // For regular camera feed\n      else if (camera.id) {\n        setStreamUrl(`${API_BASE}/stream/${camera.id}`);\n      }\n      setError(null);\n      setIsLoading(true);\n    } else {\n      setStreamUrl(null);\n      setIsLoading(false);\n    }\n  }, [camera === null || camera === void 0 ? void 0 : camera.id, camera === null || camera === void 0 ? void 0 : camera.rtspUrl, isLive]); // ðŸ”´ Changed dependencies\n\n  const handleRetry = () => {\n    if (camera && isLive) {\n      setIsLoading(true);\n      setError(null);\n      // Force reload by updating timestamp\n      if (camera.rtspUrl && !camera.id) {\n        setStreamUrl(`${API_BASE}/preview-stream?rtspUrl=${encodeURIComponent(camera.rtspUrl)}&t=${Date.now()}`);\n      } else if (camera.id) {\n        setStreamUrl(`${API_BASE}/stream/${camera.id}?t=${Date.now()}`);\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"video-preview\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-title\",\n        children: camera ? camera.name : \"No Camera Selected\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 46,\n        columnNumber: 9\n      }, this), isLive && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"live-badge\",\n        children: \"LIVE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 20\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"video-placeholder\",\n      style: {\n        position: \"relative\"\n      },\n      children: [streamUrl ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: 'absolute',\n            top: '50%',\n            left: '50%',\n            transform: 'translate(-50%, -50%)',\n            color: '#fff',\n            zIndex: 1,\n            padding: '10px 20px',\n            background: 'rgba(0,0,0,0.7)',\n            borderRadius: '4px'\n          },\n          children: \"Loading stream...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 56,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: streamUrl,\n          alt: \"camera-live\",\n          style: {\n            width: \"100%\",\n            height: \"100%\",\n            objectFit: \"cover\",\n            backgroundColor: \"#000\",\n            display: isLoading ? \"none\" : \"block\"\n          },\n          onLoad: () => {\n            console.log(\"Stream loaded successfully\");\n            setIsLoading(false);\n            setError(null);\n          },\n          onError: e => {\n            console.error(\"Error loading stream:\", e);\n            setError(\"Unable to load video stream. The camera may be offline.\");\n            setIsLoading(false);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : camera ? /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: \"#777\",\n          padding: \"20px\",\n          textAlign: \"center\"\n        },\n        children: [error || \"Click 'Test' to check camera connection\", isLive && !streamUrl && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: \"12px\",\n            marginTop: \"8px\"\n          },\n          children: \"Starting face recognition feed...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          color: \"#777\",\n          padding: \"20px\",\n          textAlign: \"center\"\n        },\n        children: \"Select a camera to preview live feed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 11\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"absolute\",\n          top: \"50%\",\n          left: \"50%\",\n          transform: \"translate(-50%, -50%)\",\n          textAlign: \"center\",\n          backgroundColor: \"rgba(0,0,0,0.8)\",\n          padding: \"20px\",\n          borderRadius: \"8px\",\n          color: \"white\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleRetry,\n          style: {\n            marginTop: \"10px\",\n            padding: \"8px 16px\",\n            backgroundColor: \"#007bff\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"4px\",\n            cursor: \"pointer\"\n          },\n          children: \"Retry Connection\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 44,\n    columnNumber: 5\n  }, this);\n};\n_s(VideoPreview, \"k/2rOMVR949t2AnFGB0irr+Ef2o=\");\n_c = VideoPreview;\nexport default VideoPreview;\nvar _c;\n$RefreshReg$(_c, \"VideoPreview\");","map":{"version":3,"names":["React","useState","useEffect","jsxDEV","_jsxDEV","Fragment","_Fragment","API_BASE","import","meta","env","VITE_API_BASE","VideoPreview","camera","isLive","apiBase","_s","streamUrl","setStreamUrl","error","setError","isLoading","setIsLoading","rtspUrl","id","encodeURIComponent","handleRetry","Date","now","className","children","name","fileName","_jsxFileName","lineNumber","columnNumber","style","position","top","left","transform","color","zIndex","padding","background","borderRadius","src","alt","width","height","objectFit","backgroundColor","display","onLoad","console","log","onError","e","textAlign","fontSize","marginTop","onClick","border","cursor","_c","$RefreshReg$"],"sources":["/home/owlytics/Desktop/Grow AI/frontend/src/components/VideoPreview.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\n\r\n// Use environment variable for API base URL\r\nconst API_BASE = import.meta.env.VITE_API_BASE || \"http://localhost:8000\";\r\n\r\nconst VideoPreview = ({ camera, isLive, apiBase }) => {\r\n  const [streamUrl, setStreamUrl] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // ðŸ”´ CRITICAL FIX: Use specific dependencies to prevent unnecessary re-renders\r\n    if (camera && isLive) {\r\n      // For test preview (from CameraForm)\r\n      if (camera.rtspUrl && !camera.id) {\r\n        setStreamUrl(`${API_BASE}/preview-stream?rtspUrl=${encodeURIComponent(camera.rtspUrl)}`);\r\n      }\r\n      // For regular camera feed\r\n      else if (camera.id) {\r\n        setStreamUrl(`${API_BASE}/stream/${camera.id}`);\r\n      }\r\n      setError(null);\r\n      setIsLoading(true);\r\n    } else {\r\n      setStreamUrl(null);\r\n      setIsLoading(false);\r\n    }\r\n  }, [camera?.id, camera?.rtspUrl, isLive]); // ðŸ”´ Changed dependencies\r\n\r\n  const handleRetry = () => {\r\n    if (camera && isLive) {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      // Force reload by updating timestamp\r\n      if (camera.rtspUrl && !camera.id) {\r\n        setStreamUrl(`${API_BASE}/preview-stream?rtspUrl=${encodeURIComponent(camera.rtspUrl)}&t=${Date.now()}`);\r\n      } else if (camera.id) {\r\n        setStreamUrl(`${API_BASE}/stream/${camera.id}?t=${Date.now()}`);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"video-preview\">\r\n      <div className=\"video-header\">\r\n        <div className=\"video-title\">\r\n          {camera ? camera.name : \"No Camera Selected\"}\r\n        </div>\r\n        {isLive && <div className=\"live-badge\">LIVE</div>}\r\n      </div>\r\n\r\n      <div className=\"video-placeholder\" style={{ position: \"relative\" }}>\r\n        {streamUrl ? (\r\n          <>\r\n            {isLoading && (\r\n              <div style={{\r\n                position: 'absolute',\r\n                top: '50%',\r\n                left: '50%',\r\n                transform: 'translate(-50%, -50%)',\r\n                color: '#fff',\r\n                zIndex: 1,\r\n                padding: '10px 20px',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                borderRadius: '4px'\r\n              }}>\r\n                Loading stream...\r\n              </div>\r\n            )}\r\n            <img\r\n              src={streamUrl}\r\n              alt=\"camera-live\"\r\n              style={{ \r\n                width: \"100%\", \r\n                height: \"100%\", \r\n                objectFit: \"cover\",\r\n                backgroundColor: \"#000\",\r\n                display: isLoading ? \"none\" : \"block\"\r\n              }}\r\n              onLoad={() => {\r\n                console.log(\"Stream loaded successfully\");\r\n                setIsLoading(false);\r\n                setError(null);\r\n              }}\r\n              onError={(e) => {\r\n                console.error(\"Error loading stream:\", e);\r\n                setError(\"Unable to load video stream. The camera may be offline.\");\r\n                setIsLoading(false);\r\n              }}\r\n            />\r\n          </>\r\n        ) : camera ? (\r\n          <div style={{ color: \"#777\", padding: \"20px\", textAlign: \"center\" }}>\r\n            {error || \"Click 'Test' to check camera connection\"}\r\n            {isLive && !streamUrl && (\r\n              <div style={{ fontSize: \"12px\", marginTop: \"8px\" }}>\r\n                Starting face recognition feed...\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div style={{ color: \"#777\", padding: \"20px\", textAlign: \"center\" }}>\r\n            Select a camera to preview live feed\r\n          </div>\r\n        )}\r\n        \r\n        {error && (\r\n          <div style={{\r\n            position: \"absolute\",\r\n            top: \"50%\",\r\n            left: \"50%\",\r\n            transform: \"translate(-50%, -50%)\",\r\n            textAlign: \"center\",\r\n            backgroundColor: \"rgba(0,0,0,0.8)\",\r\n            padding: \"20px\",\r\n            borderRadius: \"8px\",\r\n            color: \"white\"\r\n          }}>\r\n            <p>{error}</p>\r\n            <button \r\n              onClick={handleRetry}\r\n              style={{\r\n                marginTop: \"10px\",\r\n                padding: \"8px 16px\",\r\n                backgroundColor: \"#007bff\",\r\n                color: \"white\",\r\n                border: \"none\",\r\n                borderRadius: \"4px\",\r\n                cursor: \"pointer\"\r\n              }}\r\n            >\r\n              Retry Connection\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoPreview;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;;AAElD;AAAA,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AACA,MAAMC,QAAQ,GAAGC,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,aAAa,IAAI,uBAAuB;AAEzE,MAAMC,YAAY,GAAGA,CAAC;EAAEC,MAAM;EAAEC,MAAM;EAAEC;AAAQ,CAAC,KAAK;EAAAC,EAAA;EACpD,MAAM,CAACC,SAAS,EAAEC,YAAY,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAChD,MAAM,CAACkB,KAAK,EAAEC,QAAQ,CAAC,GAAGnB,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACoB,SAAS,EAAEC,YAAY,CAAC,GAAGrB,QAAQ,CAAC,KAAK,CAAC;EAEjDC,SAAS,CAAC,MAAM;IACd;IACA,IAAIW,MAAM,IAAIC,MAAM,EAAE;MACpB;MACA,IAAID,MAAM,CAACU,OAAO,IAAI,CAACV,MAAM,CAACW,EAAE,EAAE;QAChCN,YAAY,CAAC,GAAGX,QAAQ,2BAA2BkB,kBAAkB,CAACZ,MAAM,CAACU,OAAO,CAAC,EAAE,CAAC;MAC1F;MACA;MAAA,KACK,IAAIV,MAAM,CAACW,EAAE,EAAE;QAClBN,YAAY,CAAC,GAAGX,QAAQ,WAAWM,MAAM,CAACW,EAAE,EAAE,CAAC;MACjD;MACAJ,QAAQ,CAAC,IAAI,CAAC;MACdE,YAAY,CAAC,IAAI,CAAC;IACpB,CAAC,MAAM;MACLJ,YAAY,CAAC,IAAI,CAAC;MAClBI,YAAY,CAAC,KAAK,CAAC;IACrB;EACF,CAAC,EAAE,CAACT,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEW,EAAE,EAAEX,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEU,OAAO,EAAET,MAAM,CAAC,CAAC,CAAC,CAAC;;EAE3C,MAAMY,WAAW,GAAGA,CAAA,KAAM;IACxB,IAAIb,MAAM,IAAIC,MAAM,EAAE;MACpBQ,YAAY,CAAC,IAAI,CAAC;MAClBF,QAAQ,CAAC,IAAI,CAAC;MACd;MACA,IAAIP,MAAM,CAACU,OAAO,IAAI,CAACV,MAAM,CAACW,EAAE,EAAE;QAChCN,YAAY,CAAC,GAAGX,QAAQ,2BAA2BkB,kBAAkB,CAACZ,MAAM,CAACU,OAAO,CAAC,MAAMI,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,CAAC;MAC1G,CAAC,MAAM,IAAIf,MAAM,CAACW,EAAE,EAAE;QACpBN,YAAY,CAAC,GAAGX,QAAQ,WAAWM,MAAM,CAACW,EAAE,MAAMG,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,CAAC;MACjE;IACF;EACF,CAAC;EAED,oBACExB,OAAA;IAAKyB,SAAS,EAAC,eAAe;IAAAC,QAAA,gBAC5B1B,OAAA;MAAKyB,SAAS,EAAC,cAAc;MAAAC,QAAA,gBAC3B1B,OAAA;QAAKyB,SAAS,EAAC,aAAa;QAAAC,QAAA,EACzBjB,MAAM,GAAGA,MAAM,CAACkB,IAAI,GAAG;MAAoB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACzC,CAAC,EACLrB,MAAM,iBAAIV,OAAA;QAAKyB,SAAS,EAAC,YAAY;QAAAC,QAAA,EAAC;MAAI;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC9C,CAAC,eAEN/B,OAAA;MAAKyB,SAAS,EAAC,mBAAmB;MAACO,KAAK,EAAE;QAAEC,QAAQ,EAAE;MAAW,CAAE;MAAAP,QAAA,GAChEb,SAAS,gBACRb,OAAA,CAAAE,SAAA;QAAAwB,QAAA,GACGT,SAAS,iBACRjB,OAAA;UAAKgC,KAAK,EAAE;YACVC,QAAQ,EAAE,UAAU;YACpBC,GAAG,EAAE,KAAK;YACVC,IAAI,EAAE,KAAK;YACXC,SAAS,EAAE,uBAAuB;YAClCC,KAAK,EAAE,MAAM;YACbC,MAAM,EAAE,CAAC;YACTC,OAAO,EAAE,WAAW;YACpBC,UAAU,EAAE,iBAAiB;YAC7BC,YAAY,EAAE;UAChB,CAAE;UAAAf,QAAA,EAAC;QAEH;UAAAE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CACN,eACD/B,OAAA;UACE0C,GAAG,EAAE7B,SAAU;UACf8B,GAAG,EAAC,aAAa;UACjBX,KAAK,EAAE;YACLY,KAAK,EAAE,MAAM;YACbC,MAAM,EAAE,MAAM;YACdC,SAAS,EAAE,OAAO;YAClBC,eAAe,EAAE,MAAM;YACvBC,OAAO,EAAE/B,SAAS,GAAG,MAAM,GAAG;UAChC,CAAE;UACFgC,MAAM,EAAEA,CAAA,KAAM;YACZC,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;YACzCjC,YAAY,CAAC,KAAK,CAAC;YACnBF,QAAQ,CAAC,IAAI,CAAC;UAChB,CAAE;UACFoC,OAAO,EAAGC,CAAC,IAAK;YACdH,OAAO,CAACnC,KAAK,CAAC,uBAAuB,EAAEsC,CAAC,CAAC;YACzCrC,QAAQ,CAAC,yDAAyD,CAAC;YACnEE,YAAY,CAAC,KAAK,CAAC;UACrB;QAAE;UAAAU,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC;MAAA,eACF,CAAC,GACDtB,MAAM,gBACRT,OAAA;QAAKgC,KAAK,EAAE;UAAEK,KAAK,EAAE,MAAM;UAAEE,OAAO,EAAE,MAAM;UAAEe,SAAS,EAAE;QAAS,CAAE;QAAA5B,QAAA,GACjEX,KAAK,IAAI,yCAAyC,EAClDL,MAAM,IAAI,CAACG,SAAS,iBACnBb,OAAA;UAAKgC,KAAK,EAAE;YAAEuB,QAAQ,EAAE,MAAM;YAAEC,SAAS,EAAE;UAAM,CAAE;UAAA9B,QAAA,EAAC;QAEpD;UAAAE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CACN;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC,gBAEN/B,OAAA;QAAKgC,KAAK,EAAE;UAAEK,KAAK,EAAE,MAAM;UAAEE,OAAO,EAAE,MAAM;UAAEe,SAAS,EAAE;QAAS,CAAE;QAAA5B,QAAA,EAAC;MAErE;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CACN,EAEAhB,KAAK,iBACJf,OAAA;QAAKgC,KAAK,EAAE;UACVC,QAAQ,EAAE,UAAU;UACpBC,GAAG,EAAE,KAAK;UACVC,IAAI,EAAE,KAAK;UACXC,SAAS,EAAE,uBAAuB;UAClCkB,SAAS,EAAE,QAAQ;UACnBP,eAAe,EAAE,iBAAiB;UAClCR,OAAO,EAAE,MAAM;UACfE,YAAY,EAAE,KAAK;UACnBJ,KAAK,EAAE;QACT,CAAE;QAAAX,QAAA,gBACA1B,OAAA;UAAA0B,QAAA,EAAIX;QAAK;UAAAa,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eACd/B,OAAA;UACEyD,OAAO,EAAEnC,WAAY;UACrBU,KAAK,EAAE;YACLwB,SAAS,EAAE,MAAM;YACjBjB,OAAO,EAAE,UAAU;YACnBQ,eAAe,EAAE,SAAS;YAC1BV,KAAK,EAAE,OAAO;YACdqB,MAAM,EAAE,MAAM;YACdjB,YAAY,EAAE,KAAK;YACnBkB,MAAM,EAAE;UACV,CAAE;UAAAjC,QAAA,EACH;QAED;UAAAE,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CACN;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAACnB,EAAA,CArIIJ,YAAY;AAAAoD,EAAA,GAAZpD,YAAY;AAuIlB,eAAeA,YAAY;AAAC,IAAAoD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}